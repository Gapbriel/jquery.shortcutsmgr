/*!
 * jQuery ShortcutMgr Plugin v0.1
 * https://github.com/mauroBus/jquery.shortcutmgr
 *
 * Copyright 2013 Mauro Buselli
 * Released under the MIT license
 */
(function(a){if(typeof define==="function"&&define.amd){define(["jquery"],a)}else{a(jQuery,Class)}}(function(b,a){var d=a.extend({regions:null,keys:[],key:null,selectionClass:null,init:function(e){this.regions={};this.selectionClass=e&&e.selectionClass||"highlighted-region"},addRegion:function(e){var f=e;if(!(e instanceof c)){var g=b.extend(e,{shortcutsMgr:this,selectionClass:e.selectionClass||this.selectionClass});f=new c(g)}this.regions[f.name]=this.regions[f.name]||{};this.regions[f.name]=f;this.keys.push(f.name);return f},removeRegion:function(f){delete this.regions[f];var e=this.keys.indexOf(f);this.keys.splice(e,1)},startRegion:function(h,f,g){var e,j;if(!this.regions[h]){return}if(this.regions[this.currentKey]){this.regions[this.currentKey].unPlug()}j=this.regions[h].plug(g);if(!j){var i=f?this.getNextRegion(h):this.getPrevRegion(h);this.startRegion(i,f)}else{this.currentKey=h}},startNextRegion:function(){var e=this.getNextRegion();this.startRegion(e,true)},startPrevRegion:function(){var e=this.getPrevRegion();this.startRegion(e,false)},stopRegion:function(e){if(this.regions[e]){this.regions[e].unPlug()}},getNextRegion:function(g){var f=g?g:this.currentKey;for(var e=0;e<=this.keys.length-1;e++){if(this.keys[e]===f){return(this.keys[e+1]===undefined)?this.keys[0]:this.keys[e+1]}}},getPrevRegion:function(g){var f=g?g:this.currentKey;for(var e=0;e<=this.keys.length-1;e++){if(this.keys[e]===f){return(this.keys[e-1])?this.keys[e-1]:this.keys[this.keys.length-1]}}},getNext:function(f){for(var e=0;e<=this.keys.length-1;e++){if(this.keys[e]===f){return(this.keys[++e]===undefined)?this.keys[0]:this.keys[e]}}},getActiveRegion:function(){return this.regions[this.currentKey]}});var c=a.extend({defaults:{name:null,events:[],regionEl:null,activated:false,enableInInput:false,$inputs:null,shortcutsMgr:null,selectionClass:null,autoActivateEvent:null},init:function(e){b.extend(this,this.defaults,e);this.onEnterRegion=(e.onEnterRegion&&b.isFunction(e.onEnterRegion))?e.onEnterRegion:this.onEnterRegion;this.onExitRegion=(e.onExitRegion&&b.isFunction(e.onExitRegion))?e.onExitRegion:this.onExitRegion;if(this.enableInInput){this.$inputs=b(this.regionEl+" input")}this.bindActivateRegion()},addEvent:function(f){this.events.push(f)},addEvents:function(f){var g;for(g in f){this.addEvent(g)}},plug:function(f){if(!b(this.regionEl).length){return false}this.activated=true;var h,g;for(h in this.events){b(document).bind(this.events[h].types,this.events[h].keys,this.events[h].handler);if(this.enableInInput){g=this.events[h].keys;if(_.indexOf(g,"space")<0&&_.indexOf(g,"return")<0){this.$inputs.bind(this.events[h].types,this.events[h].keys,this.events[h].handler)}}}this.onEnterRegion(f);b(this.regionEl).addClass(this.selectionClass);return true},unPlug:function(){this.activated=false;var f;for(f in this.events){if(this.events[f].types){b(document).unbind(this.events[f].types,this.events[f].handler);if(this.enableInInput){this.$inputs.unbind(this.events[f].types,this.events[f].handler)}}}b(this.regionEl).removeClass(this.selectionClass);this.onExitRegion()},bindActivateRegion:function(){if(this.regionEl&&this.autoActivateEvent){var e=this;b(document).ready(function(){b(e.regionEl).on(e.autoActivateEvent,e.activateRegion.bind(e))})}},activateRegion:function(e){if(!this.activated){this.shortcutsMgr.startRegion(this.name,false,e.target)}},onEnterRegion:function(){},onExitRegion:function(){}});b.ShortcutsMgr=d}));